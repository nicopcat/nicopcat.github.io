---
title: "如何用腾讯云的储存对象(COS)结合CDN作图床"
date: 2022-05-26T01:00:00+08:00
draft: false
tags: ["腾讯云","图床","CDN"]
description: '以及如何收费'
layout: doc
---
# 如何用腾讯云的储存对象(COS)结合CDN作图床
众所周知，图床是一个非常方便的玩意：在图床网站上传本地图片，它就给你生成一个地址，访问这个地址你就能获得图片。但是免费的图床非常不稳定，讲不定下一次访问的时候图就挂了。偶然间知道腾讯云有[对象存储（Cloud Object Storage，COS）](https://cloud.tencent.com/act/event/cos-novice)，可以放一些静态数据，结合 Picgo 便得到一个非常便捷的图床。  

经过几个月的使用，我依然对 COS 服务的收费不太熟悉。一个月的费用也就几块钱，所以就这么将就着。直到最近我购买了一个 10G 的 COS 资源包，自以为高枕无忧，却依然收到腾讯云给我发的欠费提醒。这让我非常想弄明白 COS 存储服务，包括引用数据时（后来才知道，这个操作消耗的流量叫*外网下行流量*）是如何收费的。  

随后又阅读了几篇文章，其中有好几个人推荐 COS 对象结合 CDN 来作图床，说是比直接把 COS 当作图床的费用更低。对于 CDN 我也不是很明白，直到看到 jdhao 的[这篇文章](https://jdhao.github.io/2020/03/16/tencent_cos_cdn_setup/)才搞明白 `COS`、`CDN` 以及`回源`等概念。  

# 对象存储（Cloud Object Storage，COS）
**COS**： 是腾讯云提供的文件存储服务，用户可通过网络随时存储和查看数据。  

**流量**：是用户在使用和访问对象存储会产生的数据流量，分为外网上行流量、外网下行流量、内网上行流量、内网下行流量、CDN 回源流量等。  

作为图床，我们需要关注的三项计费是：**存储容量费用**、**流量费用**以及**请求费用**。  
## 存储容量费用
新用户会赠送6个月10G的流量包，6个月之后开始按下面两种方式计费：

**计费方式**：  
- 按量计费：每月结算  
    拿广州地区的标准存储计算，单价0.118元/GB/月   
- 购买存储容量包：每日重置    
    比如10G/月需要0.85元   

参考：https://cloud.tencent.com/document/product/436/53482   
 
## 流量费用（外网下行流量）
流量主要是指外网上行流量、内网上行流量、内网下行流量和外网下行流量，前三项都不收费，所以只关注**外网下行流量**，从 COS 下载到用户本地或客户端所产生的流量就是下行流量。    

**计费方式**：  
- 按量计费：日结计费   
- 资源包：外网下行流量包    

流量是费用产生的主要来源，价格大概是0.5元/GB。  

5月我的桶生成了 3.11 GB 的流量，收取费用 1.56元。 
个人网站流量小，收取的费用微乎其微 ……  

（搞了半天，我发现我这小小站什么包都不买才是最省钱的）   

参看：https://cloud.tencent.com/document/product/436/53863  

## 请求费用
请求次数包括用户请求次数和用户配置功能后产生的后端请求次数。价格大概是0.01元万次，不足则不收取，基本可以忽略。

# CDN的概念
以下引用 jdhao 的文章：  

>**源站**：简单理解，源站可以理解为最初的站点，由于这个站点的资源（图像，html，视频等）访问不方便，所以我们可以借助 CDN 来加速访问，减轻或者杜绝对源站资源的直接访问。相当 CDN 的节点服务器把源站的资料拷贝到自己的硬盘上，当有用户请求某个数据的时候，实际上访问到的是 CDN 的节点拷贝的数据。  


>**回源**：当源站的资料有更新，或者访问 CDN 节点缓存中不存在的某个资源，CDN 的节点会向源站请求更新的数据或者新的资料，这个过程就叫回源。CDN 可以设置回源时间，如果源站内容更新频繁，回源频率可以高一些，保证资料和源站一致，否则，回源的频率可以降低，减少对源站的压力和流量消耗。  


>**回源鉴权**：当 CDN 节点把源站的资料拷贝到该节点时，源站需要鉴定这些节点是否有从自己这里拷贝资料的适当权限，如果有权限，才可以拷贝资料。  

CDN 原来就是类似**资料中转站**这样的存在。
## COS 作为 CDN 源站时产生的流量
CDN 流量计费包括：**CDN 计费（加速）**和**COS 计费（回源）。**
### CDN 计费（加速）
计费阶梯：  
![CDN计费](https://nic-gz-1308403500.file.myqcloud.com/posts/how-does-tencent-cloud-cos-and-cdn-work-20220526140544.png)
计费说明：https://cloud.tencent.com/document/product/228/2949
### COS 计费（回源）
CDN 回源计费：
![cos-vs-cdn](https://nic-gz-1308403500.file.myqcloud.com/posts/how-does-tencent-cloud-cos-and-cdn-work-20220526135621.png)


COS 作为 CDN 源站的计费如下：
![CDN计费](https://qcloudimg.tencent-cloud.cn/raw/5f9a3ca640146003988e7642134239cf.svg)  

## 但这么一通算下来……
我买的资源包：  
1. 标准存储容量包  9.77元/10GB/1年 -> 1.18 元/月  
2. CDN 回源流量包  12.42元/10GB/1年 -> 1.50 元/月  
3. 中国境内CDN流量包  3元/50GB/1年   

买资源包花了：￥25.19~    
什么包都不买：￥1.6~   

---
# 参考
- [腾讯云对象存储博客图床开启 CDN 加速(不需要购买额外域名)](https://jdhao.github.io/2020/03/16/tencent_cos_cdn_setup/)
- [COS-CDN 计费说明](https://cloud.tencent.com/document/product/228/37849#cos-.E8.AE.A1.E8.B4.B9)
- [COS流量费用](https://cloud.tencent.com/document/product/436/53863)